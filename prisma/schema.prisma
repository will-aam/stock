generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./inventory.db"
}

model Usuario {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  senhaHash  String   @map("senha_hash")
  createdAt  DateTime @default(now()) @map("created_at")
  
  contagens  Contagem[]
  
  @@map("usuarios")
}

model Produto {
  id            Int      @id @default(autoincrement())
  codigoProduto String   @unique @map("codigo_produto")
  descricao     String
  createdAt     DateTime @default(now()) @map("created_at")
  
  codigosBarras CodigoBarras[]
  itensContados ItemContado[]
  
  @@map("produtos")
}

model CodigoBarras {
  codigoBarras String   @id @map("codigo_de_barras")
  produtoId    Int      @map("produto_id")
  createdAt    DateTime @default(now()) @map("created_at")
  
  produto       Produto       @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  itensContados ItemContado[]
  
  @@map("codigos_de_barras")
}

model Contagem {
  id           Int      @id @default(autoincrement())
  usuarioId    Int      @map("usuario_id")
  dataContagem DateTime @default(now()) @map("data_contagem")
  status       String   @default("em_andamento")
  observacoes  String?
  
  usuario       Usuario       @relation(fields: [usuarioId], references: [id])
  itensContados ItemContado[]
  
  @@map("contagens")
}

model ItemContado {
  id                Int      @id @default(autoincrement())
  contagemId        Int      @map("contagem_id")
  produtoId         Int      @map("produto_id")
  codigoBarrasId    String   @map("codigo_de_barras") // nome do campo escalar (chave estrangeira)
  quantidadeContada Int      @map("quantidade_contada")
  dataHora          DateTime @default(now()) @map("data_hora")
  
  contagem     Contagem     @relation(fields: [contagemId], references: [id], onDelete: Cascade)
  produto      Produto      @relation(fields: [produtoId], references: [id])
  codigoBarras CodigoBarras @relation(fields: [codigoBarrasId], references: [codigoBarras]) // campo relacional

  @@map("itens_contados")
}

